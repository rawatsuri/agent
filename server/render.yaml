# Render Blueprint - Omnichannel AI Platform
# Uses external Supabase for PostgreSQL

services:
  # Node.js Backend API Service
  - type: web
    name: omnichannel-ai-api
    runtime: node
    plan: standard
    region: singapore  # Closest to India
    buildCommand: chmod +x render-build.sh && ./render-build.sh
    startCommand: chmod +x render-start.sh && ./render-start.sh
    healthCheckPath: /health
    autoDeploy: true
    envVars:
      # Core
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: LOG_LEVEL
        value: info
      
      # Database (Supabase - set manually in Render dashboard)
      - key: DATABASE_URL
        sync: false  # Set in Render dashboard
      - key: DIRECT_URL
        sync: false  # Set in Render dashboard
      
      # Redis (Render managed)
      - key: REDIS_URL
        fromService:
          type: redis
          name: omnichannel-ai-redis
          property: connectionString
      
      # Authentication (Clerk)
      - key: CLERK_SECRET_KEY
        sync: false
      - key: CLERK_PUBLISHABLE_KEY
        sync: false
      
      # AI Services
      - key: OPENAI_API_KEY
        sync: false
      - key: AZURE_SPEECH_KEY
        sync: false
      - key: AZURE_SPEECH_REGION
        sync: false
      
      # Telephony (Exotel)
      - key: EXOTEL_SID
        sync: false
      - key: EXOTEL_API_KEY
        sync: false
      - key: EXOTEL_API_TOKEN
        sync: false
      
      # Email (SendGrid)
      - key: SENDGRID_API_KEY
        sync: false
      - key: SENDGRID_FROM_EMAIL
        sync: false
      
      # Social (Meta WhatsApp/Instagram)
      - key: META_APP_ID
        sync: false
      - key: META_APP_SECRET
        sync: false
      - key: META_ACCESS_TOKEN
        sync: false
      - key: META_VERIFY_TOKEN
        sync: false
      - key: WHATSAPP_PHONE_NUMBER_ID
        sync: false
      
      # Telegram
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      
      # Security
      - key: INTERNAL_API_KEY
        sync: false
      - key: ENCRYPTION_KEY
        sync: false
      - key: JWT_SECRET
        sync: false
      
      # CORS
      - key: ALLOWED_ORIGINS
        sync: false
      - key: WHITE_LIST_URLS
        sync: false
      
      # Voice Bridge URL (if deployed)
      - key: VOICE_BRIDGE_URL
        sync: false

  # Python Voice Bridge Service (Optional)
  - type: web
    name: omnichannel-ai-voice
    runtime: python
    plan: standard
    region: singapore
    rootDir: voice-bridge
    buildCommand: pip install -r requirements.txt
    startCommand: python app.py
    healthCheckPath: /health
    autoDeploy: true
    envVars:
      - key: PORT
        value: 10000
      - key: PYTHONPATH
        value: .
      - key: NODE_API_URL
        fromService:
          type: web
          name: omnichannel-ai-api
          property: host
      - key: INTERNAL_API_KEY
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: AZURE_TTS_KEY
        sync: false
      - key: AZURE_TTS_REGION
        sync: false
      - key: EXOTEL_API_KEY
        sync: false
      - key: EXOTEL_API_TOKEN
        sync: false
      - key: EXOTEL_SID
        sync: false
      - key: DEEPGRAM_API_KEY
        sync: false

# Redis for caching and queues (Render managed)
  - type: redis
    name: omnichannel-ai-redis
    plan: starter
    region: singapore
    ipAllowList: []
